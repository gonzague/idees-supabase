"use strict";exports.id=169,exports.ids=[169],exports.modules={67497:(a,b,c)=>{c.d(b,{HW:()=>h,Ri:()=>f,qc:()=>i,r:()=>g});var d=c(62046),e=c(70495);async function f(){let a=await (0,e.UL)();return(0,d.UU)("https://oxjldqwvwvugupagaplq.supabase.co","sb_publishable_fwkmmxPGRcL9odtCJKyU6A_aOG_tLvO",{global:{headers:{cookie:a.getAll().map(a=>`${a.name}=${a.value}`).join("; ")}},auth:{flowType:"pkce",autoRefreshToken:!1,detectSessionInUrl:!1,persistSession:!1}})}async function g(){return(0,d.UU)("https://oxjldqwvwvugupagaplq.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})}async function h(){let a=await f(),{data:{user:b}}=await a.auth.getUser();if(!b)return null;let{data:c}=await a.from("profiles").select("*").eq("id",b.id).single();return c?{id:b.id,email:b.email,username:c.username,avatar_url:c.avatar_url,is_admin:c.is_admin,is_banned:c.is_banned,created_at:c.created_at,updated_at:c.updated_at}:null}async function i(){let a=await h();return a?.is_admin===!0}},92045:(a,b,c)=>{c.d(b,{DV:()=>t,H9:()=>m,KW:()=>p,Kk:()=>n,Q2:()=>r,VZ:()=>s,Vj:()=>q,_R:()=>u,ke:()=>o});var d=c(75879);c(68633);var e=c(16780),f=c(82161),g=c(86802),h=c(48152),i=c(61458),j=c(63340),k=c(70401);async function l(){let a=await (0,g.b3)();return a.get("cf-connecting-ip")||a.get("x-real-ip")||a.get("x-forwarded-for")?.split(",")[0]?.trim()||"unknown"}async function m(a,b){let c,d=await l();if(!(0,j.E)(`suggestion:${d}`,{maxRequests:5,windowMs:3e5}).allowed)return{errors:{_form:["Trop de suggestions. R\xe9essayez dans quelques minutes."]}};let g=b.get("turnstileToken");if(!await (0,i.l)(g))return{errors:{_form:["V\xe9rification anti-spam \xe9chou\xe9e. Veuillez r\xe9essayer."]}};let m=await (0,h.HW)();if(!m)return{errors:{_form:["Vous devez \xeatre connect\xe9 pour proposer un sujet"]}};if(m.is_banned)return{errors:{_form:["Votre compte a \xe9t\xe9 suspendu"]}};let n=b.get("title"),o=b.get("description"),p=b.getAll("tags"),q={};if(!n||n.length<k.L0?q.title=[`Le titre doit contenir au moins ${k.L0} caract\xe8res`]:n.length>k.Dr&&(q.title=[`Le titre doit contenir moins de ${k.Dr} caract\xe8res`]),o&&o.length>k.u9&&(q.description=[`La description doit contenir moins de ${k.u9} caract\xe8res`]),Object.keys(q).length>0)return{errors:q};try{let a=await (0,h.Ri)(),{data:b,error:d}=await a.from("suggestions").insert({user_id:m.id,title:n.trim(),description:o?.trim()||"",status:"open"}).select("id").single();if(d||!b)return console.error("Create suggestion error:",d),{errors:{_form:["\xc9chec de la cr\xe9ation. Veuillez r\xe9essayer."]}};if(c=b.id,p.length>0){let b=p.map(a=>({suggestion_id:c,tag_id:a}));await a.from("suggestion_tags").insert(b)}}catch(a){return console.error("Create suggestion error:",a),{errors:{_form:["\xc9chec de la cr\xe9ation. Veuillez r\xe9essayer."]}}}(0,e.revalidatePath)("/"),(0,f.redirect)(`/suggestions/${c}`)}async function n(a,b){let c=await (0,h.HW)();if(!c)return{success:!1,error:"Non autoris\xe9"};try{let d=await (0,h.Ri)(),{data:f}=await d.from("suggestions").select("user_id").eq("id",a).single();if(!f)return{success:!1,error:"Suggestion non trouv\xe9e"};if(f.user_id!==c.id&&!c.is_admin)return{success:!1,error:"Non autoris\xe9"};let g={};if(void 0!==b.title&&(g.title=b.title),void 0!==b.description&&(g.description=b.description),void 0!==b.icon&&(g.icon=b.icon),Object.keys(g).length>0){let{error:b}=await d.from("suggestions").update(g).eq("id",a);if(b)throw b}if(void 0!==b.tags&&(await d.from("suggestion_tags").delete().eq("suggestion_id",a),b.tags.length>0)){let c=b.tags.map(b=>({suggestion_id:a,tag_id:b}));await d.from("suggestion_tags").insert(c)}return(0,e.revalidatePath)("/"),(0,e.revalidatePath)(`/suggestions/${a}`),{success:!0}}catch(a){return console.error("Update suggestion error:",a),{success:!1,error:"\xc9chec de la mise \xe0 jour"}}}async function o(a){let b=await (0,h.HW)();if(!b)return{success:!1,error:"Non autoris\xe9"};try{let c=await (0,h.Ri)(),{data:d}=await c.from("suggestions").select("user_id").eq("id",a).single();if(!d)return{success:!1,error:"Suggestion non trouv\xe9e"};if(d.user_id!==b.id&&!b.is_admin)return{success:!1,error:"Non autoris\xe9"};let{error:f}=await c.from("suggestions").delete().eq("id",a);if(f)throw f;return(0,e.revalidatePath)("/"),{success:!0}}catch(a){return console.error("Delete suggestion error:",a),{success:!1,error:"\xc9chec de la suppression"}}}async function p(a){let{status:b="all",sortBy:c="votes",limit:d=10,page:e=1,search:f,tagId:g}=a||{};try{let a=await (0,h.Ri)(),i=await (0,h.HW)(),j=a.from("suggestions").select("*",{count:"exact"});if("all"!==b&&(j=j.eq("status",b)),f&&f.trim()){let a=f.trim();j=j.or(`title.ilike.%${a}%,description.ilike.%${a}%`)}if(g){let{data:b}=await a.from("suggestion_tags").select("suggestion_id").eq("tag_id",g);if(!b||!(b.length>0))return{items:[],page:1,perPage:d,totalItems:0,totalPages:0};{let a=b.map(a=>a.suggestion_id);j=j.in("id",a)}}j=j.order("created_at",{ascending:!1});let k=(e-1)*d;j=j.range(k,k+d-1);let{data:l,error:m,count:n}=await j;if(m)throw console.error("Get suggestions error:",m),m;if(!l)return{items:[],page:1,perPage:d,totalItems:0,totalPages:0};let o=l.map(a=>a.id),p=new Map,q=new Set,r=new Map;if(o.length>0){let{data:b}=await a.from("votes").select("suggestion_id, user_id, voter_id").in("suggestion_id",o);if(b)for(let a of b)p.set(a.suggestion_id,(p.get(a.suggestion_id)||0)+1),i&&(a.user_id===i.id||a.voter_id===i.id)&&q.add(a.suggestion_id);let{data:c}=await a.from("suggestion_links").select("*").in("suggestion_id",o);if(c)for(let a of c){let b=r.get(a.suggestion_id)||[];b.push(a),r.set(a.suggestion_id,b)}}let s=new Map,t=new Map;if(o.length>0){let b=[...new Set(l.map(a=>a.user_id))],{data:c}=await a.from("profiles").select("id, username, avatar_url").in("id",b);if(c)for(let a of c)s.set(a.id,a);let{data:d}=await a.from("suggestion_tags").select("suggestion_id, tag_id").in("suggestion_id",o);if(d&&d.length>0){let b=[...new Set(d.map(a=>a.tag_id))],{data:c}=await a.from("tags").select("*").in("id",b),e=new Map;if(c)for(let a of c)e.set(a.id,a);for(let a of d){let b=e.get(a.tag_id);if(b){let c=t.get(a.suggestion_id)||[];c.push(b),t.set(a.suggestion_id,c)}}}}let u=l.map(a=>{let b=s.get(a.user_id);return{...a,vote_count:p.get(a.id)||0,has_voted:q.has(a.id),links:r.get(a.id)||[],tags:t.get(a.id)||[],author_username:b?.username,author_avatar_url:b?.avatar_url,author_id:b?.id}});"votes"===c&&u.sort((a,b)=>b.vote_count-a.vote_count);let v=n||0,w=Math.ceil(v/d);return{items:u,page:e,perPage:d,totalItems:v,totalPages:w}}catch(a){return console.error("Get suggestions error:",a),{items:[],page:1,perPage:d,totalItems:0,totalPages:0}}}async function q(a){try{let b=await (0,h.Ri)(),c=await (0,h.HW)(),{data:d,error:e}=await b.from("suggestions").select("*").eq("id",a).single();if(e||!d)return console.error("Get suggestion error:",e),null;let{data:f}=await b.from("profiles").select("id, username, avatar_url").eq("id",d.user_id).single(),{data:g}=await b.from("suggestion_tags").select("tag_id").eq("suggestion_id",a),i=[];if(g&&g.length>0){let a=g.map(a=>a.tag_id),{data:c}=await b.from("tags").select("*").in("id",a);i=c||[]}let{data:j}=await b.from("votes").select("user_id, voter_id").eq("suggestion_id",a),k=j?.length||0,l=!!c&&(j?.some(a=>a.user_id===c.id||a.voter_id===c.id)||!1),{data:m}=await b.from("suggestion_links").select("*").eq("suggestion_id",a);return{...d,vote_count:k,has_voted:l,links:m||[],tags:i,author_username:f?.username,author_avatar_url:f?.avatar_url,author_id:f?.id}}catch(a){return console.error("Get suggestion error:",a),null}}async function r(){try{let a=await (0,h.Ri)(),{data:b,error:c}=await a.from("tags").select("*").order("name");if(c)throw c;return b||[]}catch(a){return console.error("Get tags error:",a),[]}}async function s(a,b){let c=await (0,h.HW)();if(!c?.is_admin)return{success:!1,error:"Admin requis"};try{let c=await (0,h.Ri)(),d=a.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),{data:f,error:g}=await c.from("tags").insert({name:a,slug:d,icon:b||null}).select().single();if(g)throw g;return(0,e.revalidatePath)("/"),{success:!0,tag:f}}catch(a){return console.error("Create tag error:",a),{success:!1,error:"\xc9chec de la cr\xe9ation du tag"}}}async function t(a,b){let c=await (0,h.HW)();if(!c?.is_admin)return{success:!1,error:"Admin requis"};try{let c=await (0,h.Ri)(),{error:d}=await c.from("tags").update({icon:b||null}).eq("id",a);if(d)throw d;return(0,e.revalidatePath)("/"),{success:!0}}catch(a){return console.error("Update tag icon error:",a),{success:!1,error:"\xc9chec de la mise \xe0 jour"}}}async function u(a){let b=await (0,h.HW)();if(!b?.is_admin)return{success:!1,error:"Admin requis"};try{let b=await (0,h.Ri)(),{error:c}=await b.from("tags").delete().eq("id",a);if(c)throw c;return(0,e.revalidatePath)("/"),{success:!0}}catch(a){return console.error("Delete tag error:",a),{success:!1,error:"\xc9chec de la suppression"}}}(0,c(51669).D)([m,n,o,p,q,r,s,t,u]),(0,d.A)(m,"60330c7fef4e2714cf468d534338938a297d205fa4",null),(0,d.A)(n,"60377f7ea9508ba814ea3fdbeded5d7e7efbec5752",null),(0,d.A)(o,"40f07f5eb3de84847845d80bb37b5400af373a7afb",null),(0,d.A)(p,"409c92e48fecc03cd3d5ce91cfbfe866b7086d6083",null),(0,d.A)(q,"40a798b7c5dd61cae376f5e87248f56492c3c1fda9",null),(0,d.A)(r,"004be493ceae83c3bb3cd6f69d2ddca43953d68dd4",null),(0,d.A)(s,"605030fe65c56af2665046761a869ec7bf65c07b61",null),(0,d.A)(t,"609285c355183dca2d3ee0ff585494efce118ed4fd",null),(0,d.A)(u,"408c3d1f8acf71d4ca119382ebfd9d3b6412067d55",null)},97037:(a,b,c)=>{c.r(b),c.d(b,{BLOG_DOMAIN:()=>k,BLOG_URL:()=>i,GITHUB_REPO_URL:()=>f,SITE_NAME:()=>e,SITE_URL:()=>d,TWITTER_URL:()=>g,WORDPRESS_API_URL:()=>j,YOUTUBE_URL:()=>h,getBlogLabel:()=>o,getSocialLinks:()=>l,isBlogUrl:()=>m,isWordPressEnabled:()=>n});let d="https:/idees.gonzague.me",e="Idees",f="https://github.com/gonzague/idees",g="https://x.com/gonzague",h="https://www.youtube.com/gonzaguedambricourt",i="https://gonzague.me",j=process.env.WORDPRESS_API_URL||"",k="gonzague.me";function l(){let a=[];return g&&a.push({href:g,label:"Twitter",icon:"\uD835\uDD4F"}),h&&a.push({href:h,label:"YouTube",icon:"â–¶"}),i&&a.push({href:i,label:"Blog",icon:"\uD83D\uDCDD"}),a}function m(a){return!!k&&a.includes(k)}function n(){return!!j}function o(){if(k)return k;if(i)try{return new URL(i).hostname}catch{}return"Blog"}}};