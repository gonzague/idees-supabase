(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[65],{63:(e,t,a)=>{"use strict";var r=a(7260);a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(t,{useSearchParams:function(){return r.useSearchParams}})},762:(e,t,a)=>{"use strict";a.d(t,{CommentSection:()=>j});var r=a(5155),s=a(2115),n=a(7650),l=a(63),i=a(3998),o=a(5142),d=a(1120),c=a(4466);let u=/(https?:\/\/[^\s<]+[^\s<.,;:!?)"'\]])/gi;function m(e){let{text:t,className:a}=e,s=function(e){let t,a=[],r=0,s=new RegExp(u);for(;null!==(t=s.exec(e));)t.index>r&&a.push({type:"text",content:e.slice(r,t.index)}),a.push({type:"link",content:t[0]}),r=s.lastIndex;return r<e.length&&a.push({type:"text",content:e.slice(r)}),a.length>0?a:[{type:"text",content:e}]}(t);return(0,r.jsx)("span",{className:a,children:s.map((e,t)=>"link"===e.type?(0,r.jsx)("a",{href:e.content,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 underline break-all",children:e.content},t):(0,r.jsx)("span",{children:e.content},t))})}var x=a(4719),h=a(926);let g=(0,h.createServerReference)("70e00c311f620d35e0f7bc4f9060106505e6b3b78d",h.callServer,void 0,h.findSourceMapURL,"createComment"),p=(0,h.createServerReference)("60dc085c564206277c4883959ccf400f9aade40791",h.callServer,void 0,h.findSourceMapURL,"deleteComment");var f=a(1158),b=a(9286),v=a(5239),y=a(9516);function j(e){let{suggestionId:t,comments:a,currentUser:u}=e,h=(0,l.useRouter)(),[j,k]=(0,s.useState)(""),[w,S]=(0,s.useTransition)(),[N,C]=(0,s.useState)(null),[_,R]=(0,s.useState)(a),[L,T]=(0,s.useState)(null),[D,P]=(0,s.useState)(null),[U,z]=(0,s.useState)(!1),[V,$]=(0,s.useState)(!1),[q,E]=(0,s.useState)(null),[M,I]=(0,s.useState)(!1),[F,O]=(0,s.useState)(!1),[A,B]=(0,s.useState)(null),X=(0,y.t)();(0,s.useEffect)(()=>{O(!0)},[]);let H=(0,s.useCallback)(e=>{T(e)},[]),J=(0,s.useCallback)(e=>{B(e)},[]),G=async e=>{e.preventDefault(),E(null),I(!0);let t=new FormData(e.currentTarget);A&&t.set("turnstileToken",A);let a=V?await (0,f.H)(t):await (0,b.J)(t);a.error?(E(a.error),I(!1)):(z(!1),I(!1),h.refresh())},K=()=>{z(!1),E(null),$(!1)};return(0,r.jsxs)("div",{className:"mt-8 space-y-6",children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[X.comments.title," (",_.length,")"]}),u?(0,r.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!j.trim())return;C(null);let a=j.trim();S(async()=>{let e=await g(t,a,L||void 0);if(e.success){let e={id:"temp-".concat(Date.now()),user_id:u.id,suggestion_id:t,content:a,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),author_username:u.username,author_avatar_url:u.avatar_url,author_id:u.id};R(t=>[...t,e]),k(""),T(null),h.refresh()}else if(e.errors){var r,s;C((null==(r=e.errors.content)?void 0:r[0])||(null==(s=e.errors._form)?void 0:s[0])||"Erreur")}})},className:"space-y-3",children:[(0,r.jsx)(d.T,{value:j,onChange:e=>k(e.target.value),placeholder:X.comments.placeholder,rows:3,maxLength:2e3}),N&&(0,r.jsx)("p",{className:"text-sm text-red-600 dark:text-red-400",children:N}),(0,r.jsx)(c.X,{onVerify:H}),(0,r.jsx)(i.$,{type:"submit",disabled:w||!j.trim(),children:w?X.comments.submitting:X.comments.submit})]}):(0,r.jsx)("button",{onClick:()=>z(!0),className:"w-full p-3 text-left text-sm text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-800 rounded-lg border border-dashed border-gray-300 dark:border-gray-600 hover:border-indigo-400 dark:hover:border-indigo-500 hover:text-indigo-600 dark:hover:text-indigo-400 transition-colors cursor-pointer",children:X.comments.loginToComment}),(0,r.jsx)("div",{className:"space-y-4",children:0===_.length?(0,r.jsx)("p",{className:"text-gray-400 dark:text-gray-500 italic",children:X.comments.empty}):_.map(e=>{var t,a;let s=e.author_avatar_url||null,n=(null==u?void 0:u.id)===e.user_id,l=null==u?void 0:u.is_admin;return(0,r.jsxs)("div",{className:"flex gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:s?(0,r.jsx)(v.default,{src:s,alt:"",width:32,height:32,className:"rounded-full",unoptimized:!0}):(0,r.jsx)("div",{className:"w-8 h-8 rounded-full bg-gray-300 dark:bg-gray-600 flex items-center justify-center text-xs font-medium text-gray-600 dark:text-gray-300",children:(null==(a=e.author_username)||null==(t=a[0])?void 0:t.toUpperCase())||"?"})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,r.jsxs)("span",{className:"font-medium text-gray-900 dark:text-white",children:["@",e.author_username]}),(0,r.jsx)("span",{className:"text-gray-400 dark:text-gray-500",children:"\xb7"}),e.created_at&&(0,r.jsx)("span",{className:"text-gray-400 dark:text-gray-500",children:new Date(e.created_at).toLocaleDateString("fr-FR")}),e.created_at&&e.updated_at&&e.updated_at!==e.created_at&&(0,r.jsxs)("span",{className:"text-gray-400 dark:text-gray-500 text-xs",children:["(",X.comments.edited,")"]})]}),(0,r.jsx)("p",{className:"mt-1 text-gray-700 dark:text-gray-300 whitespace-pre-wrap break-words",children:(0,r.jsx)(m,{text:e.content})})]}),(n||l)&&(0,r.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>{P(e.id)},disabled:w,className:"text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 hover:bg-red-50 dark:hover:bg-red-900/30 flex-shrink-0",children:"\xd7"})]},e.id)})}),(0,r.jsx)(x.T,{isOpen:null!==D,title:X.comments.deleteTitle,message:X.comments.deleteConfirm,confirmText:X.comments.deleteButton,cancelText:X.comments.cancelButton,onConfirm:()=>{D&&(P(null),S(async()=>{(await p(D,t)).success&&R(e=>e.filter(e=>e.id!==D))}))},onCancel:()=>P(null)}),U&&F&&(0,n.createPortal)((0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-[100]",onClick:e=>e.target===e.currentTarget&&K(),children:(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl max-w-sm w-full p-6 shadow-xl animate-in fade-in zoom-in-95 duration-200",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:V?X.auth.signUp:X.auth.signIn}),(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:"Connectez-vous pour laisser un commentaire."}),q&&(0,r.jsx)("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/30 text-red-700 dark:text-red-400 rounded-lg text-sm",children:q}),(0,r.jsxs)("form",{onSubmit:G,className:"space-y-3",children:[V&&(0,r.jsx)(o.p,{name:"username",type:"text",placeholder:X.auth.username,required:!0,minLength:3,autoComplete:"username"}),(0,r.jsx)(o.p,{name:"email",type:"email",placeholder:X.auth.email,required:!0,autoComplete:"email"}),(0,r.jsx)(o.p,{name:"password",type:"password",placeholder:X.auth.password,required:!0,minLength:8,autoComplete:V?"new-password":"current-password"}),V&&(0,r.jsx)(o.p,{name:"passwordConfirm",type:"password",placeholder:X.auth.confirmPassword,required:!0,minLength:8,autoComplete:"new-password"}),(0,r.jsx)(c.X,{onVerify:J}),(0,r.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,r.jsx)(i.$,{type:"submit",disabled:M,className:"flex-1",children:M?X.auth.loading:V?X.auth.signUp:X.auth.signIn}),(0,r.jsx)(i.$,{type:"button",variant:"outline",onClick:K,children:X.auth.cancel})]})]}),(0,r.jsx)("button",{type:"button",onClick:()=>{$(!V),E(null),B(null)},className:"mt-4 text-sm text-slate-500 hover:text-indigo-600 w-full text-center transition-colors",children:V?X.auth.hasAccount:X.auth.noAccount})]})}),document.body)]})}},1158:(e,t,a)=>{"use strict";a.d(t,{H:()=>s});var r=a(926);let s=(0,r.createServerReference)("401c702df1e1d6298b78609b78e35b9f73717d803b",r.callServer,void 0,r.findSourceMapURL,"signUp")},1774:(e,t,a)=>{"use strict";a.d(t,{VoteButton:()=>d});var r=a(5155),s=a(2115),n=a(926);let l=(0,n.createServerReference)("40442bf27ec4732e324781475c30af353aaa551e16",n.callServer,void 0,n.findSourceMapURL,"toggleVote");var i=a(3998),o=a(7531);function d(e){let{suggestionId:t,initialVoteCount:a,initialHasVoted:n}=e,[d,c]=(0,s.useTransition)(),[u,m]=(0,s.useOptimistic)({voteCount:a,hasVoted:n},(e,t)=>({voteCount:e.voteCount+(t?1:-1),hasVoted:t}));return(0,r.jsxs)(i.$,{variant:"ghost",size:"sm",onClick:()=>{c(async()=>{m(!u.hasVoted),await l(t)})},disabled:d,className:(0,o.cn)("flex flex-col items-center justify-center gap-0.5 h-auto py-2 min-w-[60px] rounded-xl border transition-all duration-200",u.hasVoted?"bg-indigo-50 border-indigo-200 text-indigo-600 hover:bg-indigo-100 hover:border-indigo-300 dark:bg-indigo-950 dark:border-indigo-800 dark:text-indigo-400":"bg-white border-slate-200 text-slate-500 hover:border-indigo-300 hover:bg-slate-50 hover:text-indigo-600 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:border-indigo-700 dark:hover:bg-gray-700"),children:[(0,r.jsx)("span",{className:(0,o.cn)("text-xl leading-none transition-transform duration-200",u.hasVoted&&"scale-110"),children:"▲"}),(0,r.jsx)("span",{className:"font-bold text-sm",children:u.voteCount})]})}},2540:(e,t,a)=>{Promise.resolve().then(a.t.bind(a,2619,23)),Promise.resolve().then(a.t.bind(a,1356,23)),Promise.resolve().then(a.bind(a,5570)),Promise.resolve().then(a.bind(a,762)),Promise.resolve().then(a.bind(a,2580)),Promise.resolve().then(a.bind(a,1774))},2580:(e,t,a)=>{"use strict";a.d(t,{FollowButton:()=>p});var r=a(5155),s=a(2115),n=a(7650),l=a(63),i=a(3998),o=a(5142),d=a(4466),c=a(926);let u=(0,c.createServerReference)("40fb480dd9cadb03c7a4e359774fcdb1ed42a9e245",c.callServer,void 0,c.findSourceMapURL,"unfollowSuggestion"),m=(0,c.createServerReference)("40fccf6c2458b7412e69ecf6bca5400f3ac3c5c0b1",c.callServer,void 0,c.findSourceMapURL,"followSuggestion");var x=a(1158),h=a(9286),g=a(9516);function p(e){let{suggestionId:t,initialIsFollowing:a,initialFollowerCount:c,isLoggedIn:p}=e,[f,b]=(0,s.useState)(a),[v,y]=(0,s.useState)(c),[j,k]=(0,s.useTransition)(),[w,S]=(0,s.useState)(!1),[N,C]=(0,s.useState)(!1),[_,R]=(0,s.useState)(null),[L,T]=(0,s.useState)(!1),[D,P]=(0,s.useState)(!1),[U,z]=(0,s.useState)(null),V=(0,l.useRouter)(),$=(0,g.t)();(0,s.useEffect)(()=>{P(!0)},[]);let q=(0,s.useCallback)(e=>{z(e)},[]),E=async e=>{e.preventDefault(),R(null),T(!0);let t=new FormData(e.currentTarget);U&&t.set("turnstileToken",U);let a=N?await (0,x.H)(t):await (0,h.J)(t);a.error?R(a.error):(V.refresh(),S(!1)),T(!1)},M=()=>{S(!1),R(null),C(!1)},I=w&&D?(0,n.createPortal)((0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-[100]",onClick:e=>e.target===e.currentTarget&&M(),children:(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl max-w-sm w-full p-6 shadow-xl animate-in fade-in zoom-in-95 duration-200",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:N?$.auth.signUp:$.auth.signIn}),(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:"Connectez-vous pour suivre cette suggestion et recevoir une notification quand elle sera r\xe9alis\xe9e."}),_&&(0,r.jsx)("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/30 text-red-700 dark:text-red-400 rounded-lg text-sm",children:_}),(0,r.jsxs)("form",{onSubmit:E,className:"space-y-3",children:[N&&(0,r.jsx)(o.p,{name:"username",type:"text",placeholder:$.auth.username,required:!0,minLength:3,autoComplete:"username"}),(0,r.jsx)(o.p,{name:"email",type:"email",placeholder:$.auth.email,required:!0,autoComplete:"email"}),(0,r.jsx)(o.p,{name:"password",type:"password",placeholder:$.auth.password,required:!0,minLength:8,autoComplete:N?"new-password":"current-password"}),N&&(0,r.jsx)(o.p,{name:"passwordConfirm",type:"password",placeholder:$.auth.confirmPassword,required:!0,minLength:8,autoComplete:"new-password"}),(0,r.jsx)(d.X,{onVerify:q}),(0,r.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,r.jsx)(i.$,{type:"submit",disabled:L,className:"flex-1",children:L?$.auth.loading:N?$.auth.signUp:$.auth.signIn}),(0,r.jsx)(i.$,{type:"button",variant:"outline",onClick:M,children:$.auth.cancel})]})]}),(0,r.jsx)("button",{type:"button",onClick:()=>{C(!N),R(null),z(null)},className:"mt-4 text-sm text-slate-500 hover:text-indigo-600 w-full text-center transition-colors",children:N?$.auth.hasAccount:$.auth.noAccount})]})}),document.body):null;return p?(0,r.jsxs)(i.$,{variant:f?"default":"outline",size:"sm",onClick:()=>{k(async()=>{f?(await u(t)).success&&(b(!1),y(e=>Math.max(0,e-1))):(await m(t)).success&&(b(!0),y(e=>e+1))})},disabled:j,className:"gap-1.5 ".concat(f?"bg-indigo-600 hover:bg-indigo-700":""),children:[(0,r.jsx)("span",{children:f?"\uD83D\uDD14":"\uD83D\uDD15"}),(0,r.jsx)("span",{children:f?"Suivi":"Suivre"}),v>0&&(0,r.jsx)("span",{className:"text-xs px-1.5 py-0.5 rounded-full ".concat(f?"bg-indigo-500 text-white":"bg-gray-100 dark:bg-gray-700"),children:v})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(i.$,{variant:"outline",size:"sm",onClick:()=>S(!0),className:"gap-1.5",children:[(0,r.jsx)("span",{children:"\uD83D\uDD14"}),(0,r.jsx)("span",{children:"Suivre"}),v>0&&(0,r.jsx)("span",{className:"text-xs bg-gray-100 dark:bg-gray-700 px-1.5 py-0.5 rounded-full",children:v})]}),I]})}},4466:(e,t,a)=>{"use strict";a.d(t,{X:()=>s}),a(5155);var r=a(2115);function s(e){let{onVerify:t,onError:a,onExpire:s}=e,n=(0,r.useRef)(null),l=((0,r.useRef)(null),(0,r.useCallback)(()=>{n.current&&window.turnstile},["",t,a,s]));return(0,r.useEffect)(()=>{},["",l]),null}},5570:(e,t,a)=>{"use strict";a.d(t,{AdminEditButton:()=>i});var r=a(5155),s=a(2115),n=a(3998),l=a(826);function i(e){let{suggestion:t,tags:a}=e,[i,o]=(0,s.useState)(!1);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.$,{variant:"outline",size:"sm",onClick:()=>o(!0),className:"gap-1.5",children:[(0,r.jsx)("span",{children:"✏️"}),(0,r.jsx)("span",{children:"Modifier"})]}),i&&(0,r.jsx)(l.o,{suggestion:t,tags:a,onClose:()=>{o(!1),window.location.reload()},showLinks:!0})]})}},9286:(e,t,a)=>{"use strict";a.d(t,{J:()=>s});var r=a(926);let s=(0,r.createServerReference)("40b484ad547e975adbd6b6e55f4954bfc9c6be9b7e",r.callServer,void 0,r.findSourceMapURL,"signIn")}},e=>{e.O(0,[909,218,356,402,441,255,358],()=>e(e.s=2540)),_N_E=e.O()}]);